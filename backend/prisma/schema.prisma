// Prisma Schema for PKNU-Fest

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User model - ì‚¬ìš©ì (í•™ìƒ, ìš´ì˜ì§„, í‘¸ë“œíŠ¸ëŸ­ ìš´ì˜ì)
model User {
  id                String   @id @default(uuid())
  email             String   @unique
  password          String
  name              String
  phone             String
  role              UserRole @default(USER)
  isStudentVerified Boolean  @default(false) // í•™ìƒ ì¸ì¦ ì—¬ë¶€
  studentEmail      String?  @unique // ì¸ì¦í•œ í•™êµ ì´ë©”ì¼
  studentId         String?  // í•™ë²ˆ
  department        String?  // í•™ê³¼
  grade             Int?     // í•™ë…„ (1-4)
  verified          Boolean  @default(false)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  reservations Reservation[]
  foodTruck    FoodTruck?
  orders       Order[]

  @@map("users")
}

enum UserRole {
  USER   // ì¼ë°˜ ì‚¬ìš©ì
  ADMIN  // ìš´ì˜ì§„
  VENDOR // í‘¸ë“œíŠ¸ëŸ­ ìš´ì˜ì
}

// Event model - í–‰ì‚¬/í”„ë¡œê·¸ë¨
model Event {
  id            String      @id @default(uuid())
  title         String
  description   String?
  category      String // ê²Œì„, ë¨¹ê±°ë¦¬, ì²´í—˜ ë“±
  location      String
  latitude      Float
  longitude     Float
  startTime     DateTime?   // í–‰ì‚¬ ì‹œì‘ ì‹œê°„
  endTime       DateTime?   // í–‰ì‚¬ ì¢…ë£Œ ì‹œê°„
  thumbnail     String?
  images        String[] // ìƒì„¸ ì´ë¯¸ì§€ (ìµœëŒ€ 5ì¥)
  isStudentOnly Boolean     @default(false) // í•™ìƒ ì „ìš© ì—¬ë¶€
  capacity      Int? // ì¸ì› ì œí•œ (nullì´ë©´ ì œí•œ ì—†ìŒ)
  reservationEnabled Boolean @default(false) // ì˜ˆì•½/ì‹ ì²­ í™œì„±í™”
  reservationType    ReservationType? // ì˜ˆì•½ ë°©ì‹
  currentReservations Int @default(0) // í˜„ì¬ ì˜ˆì•½ ì¸ì›
  status        EventStatus @default(DRAFT)
  organizer     String? // ì£¼ìµœ ë‹¨ì²´
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  // Relations
  reservations Reservation[]
  timeSlots    TimeSlot[]

  @@map("events")
}

enum EventStatus {
  DRAFT     // ëŒ€ê¸° (ë“±ë¡ ì™„ë£Œ, ì•„ì§ ê³µê°œ ì•ˆë¨)
  PUBLISHED // ê³µê°œ (ì°¸ì—¬ìì—ê²Œ ë…¸ì¶œ)
  FULL      // ì˜ˆì•½ ë§ˆê° (ì •ì› ë„ë‹¬)
  ONGOING   // ì§„í–‰ ì¤‘
  ENDED     // ì¢…ë£Œ
}

enum ReservationType {
  FIRST_COME // ì„ ì°©ìˆœ
  SELECTION  // ì„ ì •
}

// TimeSlot model - ì‹œê°„ëŒ€ë³„ ì˜ˆì•½
model TimeSlot {
  id        String   @id @default(uuid())
  eventId   String
  startTime DateTime
  endTime   DateTime
  capacity  Int? // ì¸ì› ì œí•œ (nullì´ë©´ ì œí•œ ì—†ìŒ)
  reserved  Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  event        Event         @relation(fields: [eventId], references: [id], onDelete: Cascade)
  reservations Reservation[]

  @@map("time_slots")
}

// Reservation model - ì˜ˆì•½
model Reservation {
  id          String            @id @default(uuid())
  userId      String
  eventId     String
  timeSlotId  String?
  partySize   Int? // ì°¸ì—¬ ì¸ì› (ì¸ì› ì œí•œ ìˆì„ ê²½ìš°)
  status      ReservationStatus @default(CONFIRMED)
  qrCode      String            @unique
  checkedInAt DateTime? // ì²´í¬ì¸ ì‹œê°„
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  // Relations
  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  event    Event     @relation(fields: [eventId], references: [id], onDelete: Cascade)
  timeSlot TimeSlot? @relation(fields: [timeSlotId], references: [id], onDelete: SetNull)

  @@map("reservations")
}

enum ReservationStatus {
  PENDING    // ëŒ€ê¸° (ì„ ì • ë°©ì‹)
  CONFIRMED  // í™•ì •
  CHECKED_IN // ì²´í¬ì¸ ì™„ë£Œ
  NO_SHOW    // ë…¸ì‡¼
  CANCELLED  // ì·¨ì†Œ
  REJECTED   // ê±°ì ˆ (ì„ ì • ë°©ì‹)
}

// FoodTruck model - í‘¸ë“œíŠ¸ëŸ­
model FoodTruck {
  id          String   @id @default(uuid())
  name        String
  description String?
  location    String
  latitude    Float
  longitude   Float
  ownerId     String   @unique
  imageUrl    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  owner User       @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  menu  MenuItem[]
  orders Order[]

  @@map("food_trucks")
}

// MenuItem model - ë©”ë‰´
model MenuItem {
  id          String   @id @default(uuid())
  foodTruckId String
  name        String
  description String?
  price       Int
  imageUrl    String?
  available   Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  foodTruck  FoodTruck   @relation(fields: [foodTruckId], references: [id], onDelete: Cascade)
  orderItems OrderItem[]

  @@map("menu_items")
}

// Order model - ì£¼ë¬¸
model Order {
  id            String        @id @default(uuid())
  userId        String
  foodTruckId   String
  status        OrderStatus   @default(PENDING)
  totalPrice    Int
  pickupNumber  String?
  paymentId     String?       // ê²°ì œ ID (ëª¨ì˜ ê²°ì œì—ì„œëŠ” UUID)
  paymentMethod String?       // ê²°ì œ ìˆ˜ë‹¨ (CARD, KAKAO_PAY, TOSS_PAY)
  paymentStatus PaymentStatus @default(PENDING) // ê²°ì œ ìƒíƒœ
  paidAt        DateTime?     // ê²°ì œ ì™„ë£Œ ì‹œê°
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  // Relations
  user       User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  foodTruck  FoodTruck   @relation(fields: [foodTruckId], references: [id], onDelete: Cascade)
  orderItems OrderItem[]

  @@map("orders")
}

enum OrderStatus {
  PENDING    // ì£¼ë¬¸ ì ‘ìˆ˜
  PREPARING  // ì¡°ë¦¬ ì¤‘
  READY      // ì¤€ë¹„ ì™„ë£Œ
  COMPLETED  // ìˆ˜ë ¹ ì™„ë£Œ
  CANCELLED  // ì·¨ì†Œ
}

enum PaymentStatus {
  PENDING   // ê²°ì œ ëŒ€ê¸°
  PAID      // ê²°ì œ ì™„ë£Œ
  CANCELLED // ê²°ì œ ì·¨ì†Œ
  REFUNDED  // í™˜ë¶ˆ ì™„ë£Œ
}

// OrderItem model - ì£¼ë¬¸ ì•„ì´í…œ
model OrderItem {
  id         String   @id @default(uuid())
  orderId    String
  menuItemId String
  quantity   Int
  price      Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  order    Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  menuItem MenuItem @relation(fields: [menuItemId], references: [id], onDelete: Cascade)

  @@map("order_items")
}

// BoothZone model - ë¶€ìŠ¤ êµ¬ì—­ (ì§€ë„ í‘œì‹œìš©)
model BoothZone {
  id        String   @id @default(uuid())
  name      String   // êµ¬ì—­ ì´ë¦„ (ì˜ˆ: ê³µì—°, ë¶€ìŠ¤, í‘¸ë“œíŠ¸ëŸ­)
  color     String   // ìƒ‰ìƒ ì½”ë“œ (ì˜ˆ: #C4B5FD)
  icon      String   // ì´ëª¨ì§€ ì•„ì´ì½˜ (ì˜ˆ: ğŸµ)
  bounds    Json     // í´ë¦¬ê³¤ ì¢Œí‘œ ë°°ì—´ [{lat, lng}, ...]
  centerLat Float    // ì¤‘ì‹¬ì  ìœ„ë„
  centerLng Float    // ì¤‘ì‹¬ì  ê²½ë„
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("booth_zones")
}

